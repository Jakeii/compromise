!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("chevrotain")):"function"==typeof define&&define.amd?define(["chevrotain"],n):(e="undefined"!=typeof globalThis?globalThis:e||self).compromiseStrict=n(e.require$$0)}(this,(function(e){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=n(e);function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,n,t){return n&&o(e.prototype,n),t&&o(e,t),e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,n){return(c=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?i(e):n}function s(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=u(e);if(n){var o=u(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return l(this,t)}}function f(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,o=!1,a=void 0;try{for(var u,c=e[Symbol.iterator]();!(r=(u=c.next()).done)&&(t.push(u.value),!n||t.length!==n);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return t}(e,n)||d(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,n){if(e){if("string"==typeof e)return v(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(e,n):void 0}}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function h(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=d(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return u=e.done,e},e:function(e){c=!0,a=e},f:function(){try{u||null==t.return||t.return()}finally{if(c)throw a}}}}var m={NOOP:Symbol("NOOP"),MATCH_ANY:Symbol("MATCH_ANY"),MATCH_WORD:Symbol("MATCH_WORD"),MATCH_TAG:Symbol("MATCH_TAG"),MATCH_METHOD:Symbol("MATCH_METHOD"),MATCH_END:Symbol("MATCH_END"),JMP:Symbol("JMP"),SPLIT:Symbol("SPLIT"),GLOBAL_SAVE:Symbol("GLOBAL_SAVE"),MATCH:Symbol("MATCH"),OGROUP:Symbol("OGROUP"),CGROUP:Symbol("CGROUP"),INCV:Symbol("INCV"),JMP_LT:Symbol("JMP_LT"),SPLIT_LT:Symbol("SPLIT_LT"),LOOKAHEAD:Symbol("LOOKAHEAD"),NEGATIVE_LOOKAHEAD:Symbol("NEGATIVE_LOOKAHEAD")},O=t.default.EmbeddedActionsParser,g=t.default.Lexer,E=t.default.createToken,y=m.NOOP,S=m.MATCH_ANY,A=m.MATCH_TAG,b=m.MATCH_WORD,T=m.MATCH_METHOD,L=m.MATCH_END,M=m.JMP,C=m.SPLIT,N=m.GLOBAL_SAVE,U=m.MATCH,_=m.OGROUP,R=m.CGROUP,P=m.INCV,I=m.JMP_LT,w=m.SPLIT_LT,k=m.LOOKAHEAD,x=m.NEGATIVE_LOOKAHEAD,G=E({name:"StartOf",pattern:/\^/}),H=E({name:"EndOf",pattern:/\$/}),D=E({name:"Tag",pattern:/#([_-\w]|\\.)+/}),j=E({name:"EscapedWord",pattern:/\\[#@]([_-\w]|\\.)+/}),B=E({name:"Word",pattern:/([_-\w]|\\.)+/}),V=E({name:"Method",pattern:/@[_-\w]+/}),K=E({name:"Question",pattern:/\?/,longer_alt:B}),J=E({name:"Exclamation",pattern:/!/,longer_alt:B}),W=E({name:"Equals",pattern:/=/,longer_alt:B}),Z=E({name:"Pound",pattern:/#/,longer_alt:D}),F=E({name:"Dot",pattern:/\./,longer_alt:B}),Y=E({name:"Pipe",pattern:/\|/}),$=E({name:"Comma",pattern:/,/,longer_alt:B}),q=E({name:"Colon",pattern:/:/,longer_alt:B}),z=E({name:"Plus",pattern:/\+/}),Q=E({name:"Star",pattern:/\*/}),X=E({name:"Zero",pattern:/0/,longer_alt:B}),ee=E({name:"PositiveInt",pattern:/[1-9]\d*/,longer_alt:B}),ne=E({name:"LParenthesis",pattern:/\(/}),te=E({name:"RParenthesis",pattern:/\)/}),re=E({name:"LCurly",pattern:/\{/}),oe=E({name:"RCurly",pattern:/\}/}),ae=E({name:"NamedGroupBegin",pattern:/P</}),ue=E({name:"NamedGroupEnd",pattern:/>/,longer_alt:B}),ce=E({name:"WhiteSpace",pattern:/\s+/,group:g.SKIPPED}),ie=[ae,ue,ce,G,H,X,ee,F,j,B,V,D,J,W,Z,q,K,z,Q,$,Y,ne,te,re,oe],le={allTokens:ie,MatchParser:function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&c(e,n)}(t,e);var n=s(t);function t(){var e;r(this,t);var o=i(e=n.call(this,ie));return o.RULE("matchStatement",(function(){var e={startOf:!1,prog:[],endOf:!1};return o.OPTION((function(){o.CONSUME(G),e.startOf=!0})),e.startOf||(e.prog.push({code:N,value:!1}),e.prog.push({code:C,locs:[4,2]}),e.prog.push({code:S}),e.prog.push({code:M,loc:1}),e.prog.push({code:N,value:!0})),e.groups=[],o.SUBRULE(o.valueStatement,{ARGS:[e.prog,e.groups]}),o.OPTION1((function(){o.CONSUME(H),e.endOf=!0})),o.ACTION((function(){e.endOf&&e.prog.push({code:L}),e.prog.push({code:U})})),e})),o.RULE("valueStatement",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=[];return o.AT_LEAST_ONE({DEF:function(){o.SUBRULE(o.value,{ARGS:[e,n,t]})}}),r})),o.RULE("value",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r={code:y};e.push(r);var a=e.length;o.OR([{ALT:function(){o.CONSUME(F),e.push({code:S})}},{ALT:function(){e.push({code:b,value:o.CONSUME(B).image})}},{ALT:function(){e.push({code:b,value:o.CONSUME(j).image.substr(1)})}},{ALT:function(){e.push({code:A,value:o.CONSUME(D).image.substr(1)})}},{ALT:function(){e.push({code:b,value:o.CONSUME(X).image})}},{ALT:function(){e.push({code:b,value:o.CONSUME(ee).image})}},{ALT:function(){e.push({code:T,value:o.CONSUME(V).image.substr(1)})}},{ALT:function(){o.SUBRULE(o.group,{ARGS:[e,n,t]})}}]),o.OPTION((function(){var n=o.SUBRULE(o.valueModifier),u=n.type,c=n.greedy,i=n.min,l=n.max;switch(u){case"ZERO_OR_ONE":r.code=C,r.locs=[a,e.length];break;case"ZERO_OR_MORE":e.push({code:M,loc:a-1}),r.code=C,r.locs=[a,e.length];break;case"ONE_OR_MORE":e.push({code:C,locs:[a,e.length+1]}),c||e[e.length-1].locs.reverse();break;case"RANGE":var s=t.length;t.push(s),e.push({code:P,varId:s});var f={code:I,varId:s,value:i||0,loc:a},p=null;i===l?0===i?(r.code=M,r.loc=e.length):e.push(f):0===(i||0)&&null!==l?(r.code=C,r.locs=[a,e.length+1],p={code:w,varId:s,value:l,locs:[a,e.length+1]},e.push(p)):null!==i&&null===l?(e.push(f),p={code:C,locs:[a,e.length+1]},e.push(p)):(e.push(f),p={code:w,varId:s,value:l,locs:[a,e.length+1]},e.push(p)),!c&&p&&p.locs&&p.locs.reverse()}!c&&r.locs&&r.locs.reverse()}))})),o.RULE("valueModifier",(function(){var e={type:null,greedy:!0};return o.OR([{ALT:function(){o.CONSUME(K),e.type="ZERO_OR_ONE"}},{ALT:function(){o.CONSUME(Q),e.type="ZERO_OR_MORE"}},{ALT:function(){o.CONSUME(z),e.type="ONE_OR_MORE"}},{ALT:function(){var n=o.SUBRULE(o.rangeModifier),t=n.min,r=n.max;o.ACTION((function(){e.type="RANGE",e.min=t,e.max=r}))}}]),o.OPTION((function(){o.CONSUME1(K),o.ACTION((function(){e.greedy=!1}))})),e})),o.RULE("rangeModifier",(function(){var e={min:null,max:null};return o.CONSUME(re),o.OPTION((function(){o.OR([{ALT:function(){e.min=o.CONSUME(X).image}},{ALT:function(){e.min=o.CONSUME(ee).image}}])})),e.max=e.min,o.OPTION1((function(){o.CONSUME($),e.max=null,o.OPTION2((function(){e.max=o.CONSUME1(ee).image}))})),o.ACTION((function(){e.min&&(e.min=parseInt(e.min,10)),e.max&&(e.max=parseInt(e.max,10));var n=e.min,t=e.max;if(n&&t&&n>t)throw new Error("Range min(".concat(n,") must be greater than max(").concat(t,")."));if(null===n&&null===t)throw new Error("Range min or max must be defined.")})),o.CONSUME(oe),e})),o.RULE("group",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r={capture:!0,name:null,lookahead:!1,negative:!1};o.CONSUME(ne),o.OPTION((function(){r=o.SUBRULE(o.groupModifier)}));var a=null;r.lookahead&&(r.capture=!1,a=e,e=[]);var u=n.length;r.capture&&(n.push(r),e.push({code:_,id:u,name:r.name}));var c={code:C,locs:[]};e.push(c);var i=[];o.AT_LEAST_ONE_SEP({SEP:Y,DEF:function(){c.locs.push(e.length),o.SUBRULE(o.valueStatement,{ARGS:[e,n,t]});var r={code:M,loc:null};i.push(r),e.push(r)}}),1===c.locs.length&&(c.code=y,delete c.locs),e.pop();for(var l=0,s=i;l<s.length;l++){var f=s[l];f.loc=e.length}r.capture&&e.push({code:R,id:u,name:r.name}),r.lookahead&&(e.push({code:U}),a.push({code:r.negative?x:k,prog:e})),o.CONSUME(te)})),o.RULE("namedGroup",(function(){o.CONSUME(K),o.CONSUME(ae);var e=o.CONSUME(B).image;return o.CONSUME(ue),e})),o.RULE("nonCapturingGroup",(function(){o.CONSUME(K),o.CONSUME(q)})),o.RULE("negativeLookaheadGroup",(function(){o.CONSUME(K),o.CONSUME(J)})),o.RULE("positiveLookaheadGroup",(function(){o.CONSUME(K),o.CONSUME(W)})),o.RULE("commentGroup",(function(){o.CONSUME(K),o.CONSUME(Z)})),o.RULE("groupModifier",(function(){var e={capture:!0,name:null,lookahead:!1,negative:!1,comment:!1};return o.OR([{ALT:function(){o.SUBRULE(o.nonCapturingGroup),e.capture=!1}},{ALT:function(){e.name=o.SUBRULE(o.namedGroup)}},{ALT:function(){o.SUBRULE(o.negativeLookaheadGroup),e.capture=!1,e.lookahead=!0,e.negative=!0}},{ALT:function(){o.SUBRULE(o.positiveLookaheadGroup),e.capture=!1,e.lookahead=!0,e.negative=!1}}]),e})),e.performSelfAnalysis(),e}return t}(O)},se=m.NOOP,fe=m.MATCH_ANY,pe=m.MATCH_TAG,de=m.MATCH_WORD,ve=m.MATCH_METHOD,he=m.MATCH_END,me=m.JMP,Oe=m.SPLIT,ge=m.GLOBAL_SAVE,Ee=m.MATCH,ye=m.OGROUP,Se=m.CGROUP,Ae=m.INCV,be=m.JMP_LT,Te=m.SPLIT_LT,Le=m.LOOKAHEAD,Me=m.NEGATIVE_LOOKAHEAD,Ce=function(e,n){return Object.entries(e.tags||{}).filter((function(e){var n=f(e,2);n[0];return n[1]})).map((function(e){return e[0].toLowerCase()})).includes(n.toLowerCase())},Ne=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.save,r=void 0===t||t,o=n.saved,a=void 0===o?[]:o,u=n.groups,c=void 0===u?{}:u,i=n.vars,l=void 0===i?{}:i,s=Object.values(c).reduce((function(e,n){return e[n.id]=Object.assign({},n),e[n.id].saved=n.saved.slice(),e}),{});return{pc:e,save:r,saved:p(a),groups:s,vars:Object.assign({},l)}},Ue=function e(n,t,r){var o=n[r.pc];switch(o.code){case ge:r.save=o.value,e(n,t,Ne(r.pc+1,r));break;case se:e(n,t,Ne(r.pc+1,r));break;case me:e(n,t,Ne(o.loc,r));break;case Oe:var a,u=h(o.locs);try{for(u.s();!(a=u.n()).done;){var c=a.value;e(n,t,Ne(c,r))}}catch(e){u.e(e)}finally{u.f()}break;case ye:r.groups[o.id]={id:o.id,name:o.name,saved:[],open:!0},e(n,t,Ne(r.pc+1,r));break;case Se:r.groups[o.id].open=!1,e(n,t,Ne(r.pc+1,r));break;case Ae:r.vars[o.varId]=(r.vars[o.varId]||0)+1,e(n,t,Ne(r.pc+1,r));break;case be:r.vars[o.varId]<o.value?e(n,t,Ne(o.loc,r)):e(n,t,Ne(r.pc+1,r));break;case Te:if(r.vars[o.varId]<o.value){var i,l=h(o.locs);try{for(l.s();!(i=l.n()).done;){var s=i.value;e(n,t,Ne(s,r))}}catch(e){l.e(e)}finally{l.f()}}else e(n,t,Ne(r.pc+1,r));break;default:t.push(r)}},_e=function(e,n){if(!e.save)return e;var t,r=Object.values(e.groups).filter((function(e){return e.open})).map((function(e){return e.saved})),o=h([e.saved].concat(r));try{for(o.s();!(t=o.n()).done;){t.value.push(n)}}catch(e){o.e(e)}finally{o.f()}return e},Re=function e(n,t){var r=[],o=[],a=!1,u={},c=[],i=Symbol("END");t=t.concat(i),Ue(n,r,Ne(0));for(var l=0;l<t.length&&0!==r.length;l++){for(var s=t[l],f=0;f<r.length;f++){var p=r[f],d=n[p.pc],v=!1;switch(d.code){case fe:s!==i&&Ue(n,o,Ne(p.pc+1,_e(p,s)));break;case de:s.text&&s.text.toLowerCase()===d.value.toLowerCase()&&Ue(n,o,Ne(p.pc+1,_e(p,s)));break;case pe:Ce(s,d.value)&&Ue(n,o,Ne(p.pc+1,_e(p,s)));break;case ve:s[d.value]()&&Ue(n,o,Ne(p.pc+1,_e(p,s)));break;case he:s===i&&Ue(n,r,Ne(p.pc+1,p));break;case Le:e(d.prog,t.slice(l)).found&&Ue(n,r,Ne(p.pc+1,p));break;case Me:e(d.prog,t.slice(l)).found||Ue(n,r,Ne(p.pc+1,p));break;case Ee:c=p.saved,u=p.groups,a=!0,v=!0;break;default:throw new Error("Unsuppored Op code: ".concat(d.code))}if(v)break}r=o,o=[]}return a?{found:a,saved:c,groups:u}:{found:a}},Pe=t.default.Lexer,Ie=le.MatchParser,we=Re,ke=new Pe(le.allTokens),xe=new Ie,Ge=function(){function e(n){r(this,e),this.errors=n}return a(e,[{key:"toString",value:function(){return"NLP RegexP Parsing error: ".concat(this.message)}},{key:"message",get:function(){return this.errors[0].message}}]),e}(),He=function(){function e(n){if(r(this,e),n.prog)return this.regex=n.regex,void(this.prog=n.prog.slice());var t=ke.tokenize(n).tokens;xe.input=t;var o=null;try{o=xe.matchStatement()}catch(e){throw new Ge([e])}if(xe.errors.length>0)throw new Ge(xe.errors);this.regex=n,this.prog=o.prog}return a(e,[{key:"exec",value:function(e){switch(e.isA.toLowerCase()){case"doc":return this.execDoc(e);case"phrase":return this.execPhrase(e);default:throw new Error("Invalid type, must be Document or Phrase")}}},{key:"execDoc",value:function(e){var n=this;return e.buildFrom(e.list.map((function(e){return n.execPhrase(e)})).filter((function(e){return null!==e})))}},{key:"execPhrase",value:function(e){var n=we(this.prog,e.terms()),t=n.found,r=n.saved,o=void 0===r?[]:r,a=n.groups,u=void 0===a?{}:a,c=Object.values(u).reduce((function(e,n){var t=Object.assign({},e);return t[parseInt(n.id,10)]={group:n.name||"".concat(n.id),start:n.saved[0]&&n.saved[0].id||0,length:n.saved.length},t}),{});return t&&o[0]&&o[0].id?e.buildFrom(o[0].id,o.length,c):null}}]),e}(),De={NLPMatchLexer:ke,parserInstance:xe,NLPRegexParseError:Ge,NLPRegexP:He}.NLPRegexP;return function(e,n,t,r){t.preCompile=function(e){return new De(e)};var o=function(e){return(e=new De(e)).exec(this)};e.prototype.strictMatch=o,r.prototype.strictMatch=o}}));
